import{_ as u,h as d,u as l,o as m,c as p,e as c,p as h,i as _}from"./index.ebdd458b.js";const y="http://195.15.226.172:7585",S="nope",g={name:"App",data:()=>({items:[],stripe:"",elements:""}),async mounted(){await d().fetchCartProducts();const e=d().productsInCart;e&&(this.items=e.map(t=>t)),document.querySelectorAll('script[src="//js.stripe.com/v3/"]').length==0?this.includeStripe("js.stripe.com/v3/",function(){this.configureStripe()}.bind(this)):this.configureStripe(),this.initialize(),this.checkStatus()},methods:{async initialize(){const t=(await l().user)._id;console.log("userId",t);const s=this.items,i=await fetch(`${y}/products/create-payment-intent`,{method:"POST",headers:{"Content-Type":"application/json"},authorization:`Bearer ${localStorage.getItem("token")}`,body:JSON.stringify({items:s,userId:t})}),{clientSecret:o}=await i.json(),n={theme:"stripe"};this.elements=this.stripe.elements({appearance:n,clientSecret:o});const a={layout:"tabs"};this.elements.create("payment",a).mount("#payment-element")},async handleSubmit(e){e.preventDefault(),this.setLoading(!0);const t=this.elements,{error:s}=await this.stripe.confirmPayment({elements:t,confirmParams:{return_url:"http://localhost:5173/checkoutConfirm"}});s.type==="card_error"||s.type==="validation_error"?this.showMessage(s.message):this.showMessage("An unexpected error occurred."),this.setLoading(!1)},async checkStatus(){const e=new URLSearchParams(window.location.search).get("payment_intent_client_secret");if(console.log("clientSecret",e),!e)return;const{paymentIntent:t}=await this.stripe.retrievePaymentIntent(e);switch(console.log("paymentIntent.status",t.status),t.status){case"succeeded":this.showMessage("Payment succeeded !");break;case"processing":this.showMessage("Your payment is processing.");break;case"requires_payment_method":this.showMessage("Your payment was not successful, please try again.");break;default:this.showMessage("Something went wrong.");break}},includeStripe(e,t){let s=document,i="script",o=s.createElement(i),n=s.getElementsByTagName(i)[0];o.src="//"+e,t&&o.addEventListener("load",function(a){t(null,a)},!1),n.parentNode.insertBefore(o,n)},configureStripe(){this.stripe=Stripe(S)},showMessage(e){const t=document.querySelector("#payment-message");t.classList.remove("hidden"),t.textContent=e,setTimeout(function(){t.classList.add("hidden"),e=""},4e3)},setLoading(e){e?(document.querySelector("#submit").disabled=!0,document.querySelector("#spinner").classList.remove("hidden"),document.querySelector("#button-text").classList.add("hidden")):(document.querySelector("#submit").disabled=!1,document.querySelector("#spinner").classList.add("hidden"),document.querySelector("#button-text").classList.remove("hidden"))}}},r=e=>(h("data-v-4aeb2c24"),e=e(),_(),e),f={id:"payment-form"},I=r(()=>c("div",{id:"payment-element"},null,-1)),P=r(()=>c("div",{class:"spinner hidden",id:"spinner"},null,-1)),E=r(()=>c("span",{id:"button-text"},"Pay now",-1)),w=[P,E],b=r(()=>c("div",{id:"payment-message",class:"hidden"},null,-1));function L(e,t,s,i,o,n){return m(),p("form",f,[I,c("button",{id:"submit",onClick:t[0]||(t[0]=(...a)=>n.handleSubmit&&n.handleSubmit(...a))},w),b])}const B=u(g,[["render",L],["__scopeId","data-v-4aeb2c24"]]);export{B as default};
