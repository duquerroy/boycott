import{j as x,l as E,m as R,o as u,c as v,q as T,y as P,w as f,_ as C,g as w,b as m,e as i,z as y,A as F,B as q,C as k,D as j,E as L,h as B,x as V,G as z,r as c,a as d,d as Z,F as N,f as D,p as K,i as H}from"./index.2d4aa940.js";const M=["data-active","onDragenter","onDragover","onDragleave","onDrop"],O={__name:"DropZone",emits:["files-dropped"],setup(e,{emit:t}){let o=x(!1),l=null;function s(){o.value=!0,clearTimeout(l)}function n(){l=setTimeout(()=>{o.value=!1},50)}function b(a){n(),t("files-dropped",[...a.dataTransfer.files])}function h(a){a.preventDefault()}const p=["dragenter","dragover","dragleave","drop"];return E(()=>{p.forEach(a=>{document.body.addEventListener(a,h)})}),R(()=>{p.forEach(a=>{document.body.removeEventListener(a,h)})}),(a,I)=>(u(),v("div",{"data-active":P(o),onDragenter:f(s,["prevent"]),onDragover:f(s,["prevent"]),onDragleave:f(n,["prevent"]),onDrop:f(b,["prevent"])},[T(a.$slots,"default",{dropZoneActive:P(o)})],40,M))}};const G=["src","alt","title"],J={class:"status-indicator loading-indicator"},Y={class:"status-indicator success-indicator"},Q={class:"status-indicator failure-indicator"},W={__name:"FilePreview",props:{file:{type:Object,required:!0},tag:{type:String,default:"li"}},emits:["remove"],setup(e){return(t,o)=>(u(),w(q(e.tag),{class:"file-preview"},{default:m(()=>[i("button",{onClick:o[0]||(o[0]=l=>t.$emit("remove",e.file)),class:"close-icon"},"\xD7"),i("img",{src:e.file.url,alt:e.file.file.name,title:e.file.file.name},null,8,G),y(i("span",J,"In Progress",512),[[F,e.file.status=="loading"]]),y(i("span",Y,"Uploaded",512),[[F,e.file.status==!0]]),y(i("span",Q,"Error",512),[[F,e.file.status==!1]])]),_:1}))}},X=C(W,[["__scopeId","data-v-231e1ee9"]]),S=k("UploadStore",{state:()=>({files:[]}),actions:{addFiles(e){let t=[...e].map(o=>new $(o)).filter(o=>!this.fileExists(o.id));this.files=this.files.concat(t)},fileExists(e){return this.files.some(({id:t})=>t===e)},removeFile(e){const t=this.files.indexOf(e);t>-1&&this.files.splice(t,1)},async uploadFile(e,t){let o=new FormData;console.log("file",e.file),o.append("image",e.file),e.status="loading";let l=await fetch(t,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`},body:o});if(console.log("response",l),l.ok)return e.status=l.ok,await l.json();throw new Error(l.statusText)},async uploadFiles(e,t){if(e&&e.length)return Promise.all(e.map(o=>this.uploadFile(o,t))).then(o=>(console.log("data",o),o)).catch(o=>{throw"Le t\xE9l\xE9chargement a \xE9chou\xE9."});throw"Veuillez choisir au moins une photo."},clearFiles(){this.files=[]}}});class ${constructor(t){this.file=t,this.id=`${t.name}-${t.size}-${t.lastModified}-${t.type}`,this.url=URL.createObjectURL(t),this.status=null}}const ee={name:"App",components:{DropZone:O,FilePreview:X},data(){return{categories:[],valid:!0,title:"",description:"",price:0,categoryId:"",nameRules:[e=>!!e||"Name is required",e=>e&&e.length<=30||"Name must be equal or less than 30 characters"],descriptionRules:[e=>!!e||"Description is required",e=>e&&e.length<=300||"Description must be equal or less than 300 characters"],priceRules:[e=>!!e||"Price is required",e=>!isNaN(e)||"Price must be a number"],categoryRules:[e=>!!e||"Category is required",e=>e!==""||"Category is required"]}},computed:{...j(S,["files"])},created(){this.getCategories()},methods:{...L(S,["addFiles","removeFile","uploadFiles","clearFiles"]),async addProduct(){await this.uploadFile(this.files).then(async e=>{console.log("data uploadFile",e),await B().addProduct({title:this.title,description:this.description,price:this.price,categoryId:this.categoryId,imageUrl:e.map(o=>o.image)}).then(async o=>{console.log("data",o),V().success("Le produit a bien \xE9t\xE9 ajout\xE9")}).catch(o=>{console.log("err productStore.addProduct",o)})}).catch(e=>{console.log("err uploadFile",e)})},async getCategories(){const e=z();await e.fetchCategories(),this.categories=e.categories.categories,console.log("this.categories",this.categories)},onInputChange(e){this.addFiles(e.target.files),e.target.value=null},addFile(e){this.addFiles(e)},removeFileButton(e){this.removeFile(e)},async uploadFile(e){return new Promise((t,o)=>{this.uploadFiles(e,"http://195.15.226.172:7585/products/upload").then(l=>{this.clearFiles(),console.log("res",l),t(l)}).catch(l=>{V().error(l),o(l)})})}}},_=e=>(K("data-v-d0b6c125"),e=e(),H(),e),te=_(()=>i("h1",null,"Vendre",-1)),oe={for:"file-input"},se={key:0},le=_(()=>i("span",null,"Rel\xE2chez les photos ici",-1)),ie=_(()=>i("span",{class:"smaller"},"pour les ajouter",-1)),ae=[le,ie],re={key:1},ne=_(()=>i("span",null,"Ajouter une ou plusieurs photos",-1)),ce=_(()=>i("span",{class:"smaller"},[D(" ou "),i("strong",null,[i("em",null,"Cliquez ici")]),D(" pour s\xE9lectionner des photos ")],-1)),de=[ne,ce],ue={class:"image-list"};function pe(e,t,o,l,s,n){const b=c("FilePreview"),h=c("DropZone"),p=c("v-text-field"),a=c("v-select"),I=c("v-btn"),A=c("v-form"),U=c("v-col");return u(),w(U,{cols:"12",md:"6",lg:"6"},{default:m(()=>[te,d(h,{class:"drop-area",onFilesDropped:n.addFile},{default:m(({dropZoneActive:r})=>[i("label",oe,[r?(u(),v("span",se,ae)):(u(),v("span",re,de)),i("input",{type:"file",id:"file-input",multiple:"",onChange:t[0]||(t[0]=(...g)=>n.onInputChange&&n.onInputChange(...g))},null,32)]),y(i("ul",ue,[(u(!0),v(N,null,Z(e.files,g=>(u(),w(b,{key:g.id,file:g,tag:"li",onRemove:n.removeFileButton},null,8,["file","onRemove"]))),128))],512),[[F,e.files.length]])]),_:1},8,["onFilesDropped"]),d(A,{ref:"form",modelValue:s.valid,"onUpdate:modelValue":t[5]||(t[5]=r=>s.valid=r),"lazy-validation":"",class:"mt-3"},{default:m(()=>[d(p,{modelValue:s.title,"onUpdate:modelValue":t[1]||(t[1]=r=>s.title=r),rules:s.nameRules,label:"Titre",required:""},null,8,["modelValue","rules"]),d(p,{modelValue:s.description,"onUpdate:modelValue":t[2]||(t[2]=r=>s.description=r),rules:s.descriptionRules,label:"Description",required:""},null,8,["modelValue","rules"]),d(p,{modelValue:s.price,"onUpdate:modelValue":t[3]||(t[3]=r=>s.price=r),rules:s.priceRules,label:"Prix",required:""},null,8,["modelValue","rules"]),d(a,{modelValue:s.categoryId,"onUpdate:modelValue":t[4]||(t[4]=r=>s.categoryId=r),items:s.categories,rules:s.categoryRules,"item-value":"_id","item-text":"name","item-title":"name",label:"Categorie","single-line":"",clearable:"","return-object":"",required:""},null,8,["modelValue","items","rules"]),d(I,{color:"primary",class:"mr-4",disabled:!s.valid,onClick:n.addProduct},{default:m(()=>[D(" Ajouter le produit ")]),_:1},8,["disabled","onClick"])]),_:1},8,["modelValue"])]),_:1})}const _e=C(ee,[["render",pe],["__scopeId","data-v-d0b6c125"]]);export{_e as default};
